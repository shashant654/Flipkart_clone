{% extends 'base.html' %} 
{% load math_filters %} 
{% block content %}

<div class="container py-2">
  <h2 class="mb-5 text-center fw-bold display-5 text-gradient-info">
    <i class="bi bi-receipt me-2"></i>Order Details
  </h2>

  <div class="row g-4">
    <!-- Order Summary Card -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm rounded-4 overflow-hidden hover-lift h-100">
        <div class="card-header bg-gradient-info text-white">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-receipt me-2"></i>Order Summary
          </h5>
        </div>
        <div class="card-body">
          <div class="order-detail-item mb-3 pb-3 border-bottom">
            <p class="mb-1 fw-medium text-secondary">Order Date</p>
            <p class="mb-0">{{ order.created_at|date:"j F Y h:i A" }}</p>
          </div>
          <div class="order-detail-item mb-3 pb-3 border-bottom">
            <p class="mb-1 fw-medium text-secondary">Order ID</p>
            <p class="mb-0">{{ order.order_id }}</p>
          </div>
          <div class="order-detail-item mb-3 pb-3 border-bottom">
            <p class="mb-1 fw-medium text-secondary">Tracking Number</p>
            <p class="mb-0">{{ order.tracking_no }}</p>
          </div>
          <div class="order-detail-item mb-3 pb-3 border-bottom">
            <p class="mb-1 fw-medium text-secondary">Total Price</p>
            <p class="mb-0 fw-bold">₹{{ order.total_price }}</p>
          </div>
          <div class="order-detail-item">
            <p class="mb-1 fw-medium text-secondary">Status</p>
            <span class="badge {% if order.status == 'Pending' %} bg-warning text-dark {% elif order.status == 'Completed' %} bg-success {% elif order.status == 'Cancelled' %} bg-danger {% else %} bg-secondary {% endif %} rounded-pill px-3 py-2">
              {{ order.status }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Shipping Address Card -->
    <div class="col-lg-6">
      <div class="card border-0 shadow-sm rounded-4 overflow-hidden hover-lift h-100">
        <div class="card-header bg-gradient-info text-white">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-geo-alt-fill me-2"></i>Shipping Address
          </h5>
        </div>
        <div class="card-body">
          <div class="order-detail-item mb-3 pb-3 border-bottom">
            <p class="mb-1 fw-medium text-secondary">Full Name</p>
            <p class="mb-0">{{ order.first_name }} {{ order.last_name }}</p>
          </div>
          <div class="order-detail-item mb-3 pb-3 border-bottom">
            <p class="mb-1 fw-medium text-secondary">Address</p>
            <p class="mb-0">{{ order.address }}, {{ order.city }}</p>
          </div>
          <div class="order-detail-item">
            <p class="mb-1 fw-medium text-secondary">Phone</p>
            <p class="mb-0">{{ order.phone }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Items Table -->
    <div class="col-12">
      <div class="card border-0 shadow-sm rounded-4 overflow-hidden hover-lift">
        <div class="card-header bg-gradient-info text-white">
          <h5 class="mb-0 fw-semibold">
            <i class="bi bi-box-seam me-2"></i>Items in Order
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="bg-light">
                <tr>
                  <th class="ps-4">Product</th>
                  <th>Name</th>
                  <th>Price</th>
                  <th>Quantity</th>
                  <th class="pe-4 text-end">Subtotal</th>
                  <th class="pe-4">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for item in order.orderitem_set.all %}
                <tr class="border-top hover-highlight">
                  <td class="ps-4">
                    <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}"
                      class="rounded-3 border" style="width: 60px; height: 60px; object-fit: cover" />
                  </td>
                  <td>{{ item.product.name }}</td>
                  <td>₹{{ item.price }}</td>
                  <td>{{ item.quantity }}</td>
                  <td class="pe-4 fw-semibold text-end">
                    ₹{{ item.price|multiply:item.quantity|floatformat:2 }}
                  </td>
                  <td class="pe-4">
                    {% if order.can_cancel and not item.cancelled %}
                    <form method="post" action="{% url 'cancel_order_item' order.id item.id %}" class="d-inline">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-outline-danger rounded-pill"
                        onclick="return confirm('Are you sure you want to cancel this item?')">
                        <i class="bi bi-x-circle me-1"></i> Cancel
                      </button>
                    </form>
                    {% elif item.cancelled %}
                    <span class="badge bg-secondary rounded-pill">Cancelled</span>
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .bg-gradient-info {
    background: linear-gradient(135deg, #17a2b8, #1abc9c);
  }

  .text-gradient-info {
    background: linear-gradient(to right, #17a2b8, #1abc9c);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
  }

  .hover-lift {
    transition: all 0.3s ease;
  }

  .hover-lift:hover {
    transform: translateY(-5px);
    box-shadow: 0 1rem 2rem rgba(0, 0, 0, 0.1) !important;
  }

  .hover-highlight:hover {
    background-color: rgba(23, 162, 184, 0.03);
  }

  .order-detail-item {
    transition: all 0.2s ease;
  }

  .order-detail-item:hover {
    background-color: rgba(0, 0, 0, 0.02);
  }

  .rounded-3 {
    border-radius: 0.7rem !important;
  }

  .rounded-4 {
    border-radius: 0.8rem !important;
  }

  .rounded-pill {
    border-radius: 50rem !important;
  }
  
  .btn-outline-danger {
    color: #dc3545;
    border-color: #dc3545;
  }

  .btn-outline-danger:hover {
    background-color: rgba(220, 53, 69, 0.1);
  }
</style>

{% endblock %}